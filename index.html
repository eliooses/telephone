<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Search API Sample</title>
    <!-- 1: Including the API -->
    <script src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      var imageSearch;
      var index = 0;
      var queries = [];

      // 2: Load the Google search module
      // module: search; version: 1
      google.load('search', '1');

      // 3: Assign the OnLoad function as the callback for the Google search module
      google.setOnLoadCallback(OnLoad);

      // 4: Search parameters
      function OnLoad() {
      
        // Create an Image Search instance.
        imageSearch = new google.search.ImageSearch();

        // Set searchComplete as the callback function when a search is 
        // complete.  The imageSearch object will have results in it.
        imageSearch.setSearchCompleteCallback(this, searchComplete, null);

        newSearch('justin bieber');
      }      

      function newSearch(query){
        imageSearch.execute(query);
      }


      // 5: Displaying the results
      function searchComplete() {
        console.log(imageSearch.results);

        // Check that we got results
        if (imageSearch.results && imageSearch.results.length > 0) {

          // Grab our content div, clear it.
          var contentDiv = document.getElementById('content');
          // contentDiv.innerHTML = '';

          // Loop through our results, printing them to the page.
          var results = imageSearch.results;

            // For each result write it's title and image to the screen
            var result = results[0];
            var imgContainer = document.createElement('div');
            var title = document.createElement('div');
            
            // We use titleNoFormatting so that no HTML tags are left in the title
            title.innerHTML = result.titleNoFormatting;
            var newImg = document.createElement('img');

            // There is also a result.url property which has the escaped version
            newImg.src = result.tbUrl; //Thumb
            // newImg.src = result.url;
            imgContainer.appendChild(title);
            imgContainer.appendChild(newImg);

            // Put our title + image in the content
            contentDiv.appendChild(imgContainer);

            var imageIndex = 0;
            console.log('image index: ' + imageIndex);
            // var content = imageSearch.results[imageIndex].contentNoFormatting;
            var content = imageSearch.results[imageIndex].titleNoFormatting;
            while(isStored(content)){
              console.log('Content already stored.')
              imageIndex++;
              console.log('image index: ' + imageIndex);
              // content = imageSearch.results[imageIndex].contentNoFormatting;
              content = imageSearch.results[imageIndex].titleNoFormatting;
            }
            console.log('New content: ' + content)
            queries.push(content);
            console.log(queries);

            index++;
            if(index < 20){
              //newSearch(content);
            }
        }
      }

      var isStored = function(content){
        var contentFound = false;
        for(var i = 0; i < queries.length; i++){
          if(queries[i] == content){
            contentFound = true;
            break
          }
        }
        return contentFound;        
      }

            // var newQuery = imageSearch.results[1].titleNoFormatting;
            // var endOfSentence = newQuery.lastIndexOf('.');
            // if(endOfSentence == -1){
            //   endOfSentence = newQuery.lastIndexOf('-');
            // }
            // if(endOfSentence == -1){
            //   endOfSentence = newQuery.lastIndexOf(':');
            // }
            // if(endOfSentence == -1){
            //   endOfSentence = newQuery.lastIndexOf(' '); 
            // }
            // console.log(endOfSentence);
            // newQuery = newQuery.substring(0, endOfSentence);
      
      
    </script>

  </head>
  <body style="font-family: Arial;border: 0 none;">
    <div id="content"></div>
  </body>
</html>